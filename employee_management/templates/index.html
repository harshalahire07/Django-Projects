<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="/">Employee Manager</a>
      </div>
    </nav>

    
    <div class="container">
      <div class="row mb-3">
        <div class="col-12 d-flex justify-content-between align-items-center">
          <h1 class="display-5">Employees</h1>
          <button
            type="button"
            class="btn btn-primary js-create-employee"
            data-url="{% url 'employee_create' %}"
          >
            <span class="bi bi-plus-lg"></span> Add Employee
          </button>
        </div>
      </div>

   
      <div id="employee-table-container">
        {% include 'includes/partial_employee_list.html' %}
      </div>
    </div>

 
    <div class="modal fade" id="modal-employee">
      <div class="modal-dialog">
        <div class="modal-content"></div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>


    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const modal = new bootstrap.Modal(
          document.getElementById("modal-employee"),
        );
        const modalContent = document.querySelector(
          "#modal-employee .modal-content",
        );

        const saveForm = (e) => {
          e.preventDefault();
          const form = e.target;
          const formData = new FormData(form);

          fetch(form.action, {
            method: form.method,
            body: formData,
            headers: {
              "X-Requested-With": "XMLHttpRequest",
            },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.form_is_valid) {
                document.getElementById("employee-table-container").innerHTML =
                  data.html_employee_list;
                modal.hide();
              } else {
                modalContent.innerHTML = data.html_form;
              }
            })
            .catch((error) => console.error("Error:", error));
        };

        document.body.addEventListener("click", (e) => {

          let target = e.target.closest(
            ".js-create-employee, .js-update-employee, .js-delete-employee, .js-view-employee",
          );

          if (target) {
            const url = target.getAttribute("data-url");
            fetch(url)
              .then((response) => response.json())
              .then((data) => {
                modalContent.innerHTML = data.html_form;
                modal.show();
              });
          }
        });

    
        modalContent.addEventListener("submit", (e) => {
          if (
            e.target.matches(
              ".js-employee-update-form, .js-employee-delete-form",
            )
          ) {
            saveForm(e);
          }
        });
      });
    </script>
  </body>
</html>
