{% extends 'web/base.html' %} {% block content %}
<div class="header-row">
  <div>
    <a id="back-link" href="#" class="btn btn-secondary btn-small"
      >&larr; Back to Projects</a
    >
    <h1 class="page-title" style="margin-top: 1rem">Organization Members</h1>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Role</th>
        <th>Joined</th>
      </tr>
    </thead>
    <tbody id="members-body">
      <tr>
        <td colspan="3">Loading...</td>
      </tr>
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const pathParts = window.location.pathname.split("/");
    const orgId = pathParts[2]; // /organizations/{id}/members/

    document.getElementById("back-link").href =
      `/organizations/${orgId}/projects/`;

    const tbody = document.getElementById("members-body");

    try {
      const response = await fetch(`/api/organizations/${orgId}/members/`, {
        headers: {
          Authorization: `Bearer ${localStorage.getItem("access_token")}`,
        },
      });

      if (response.status === 401) {
        logout();
        return;
      }

      const members = await response.json();

      if (members.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3">No members found.</td></tr>';
        return;
      }

      tbody.innerHTML = members
        .map(
          (m) => `
            <tr>
                <td>${m.email}</td>
                <td><span class="status-badge ${m.role === "ADMIN" ? "status-todo" : "status-done"}">${m.role}</span></td>
                <td>${new Date(m.joined_at).toLocaleDateString()}</td>
            </tr>
        `,
        )
        .join("");
    } catch (e) {
      tbody.innerHTML =
        '<tr><td colspan="3" class="alert-error">Error loading members.</td></tr>';
    }
  });
</script>
{% endblock %}
