{% extends 'web/base.html' %} {% block content %}
<div class="auth-container">
  <h2 class="auth-title">Login</h2>
  <div id="error-msg" class="alert alert-error"></div>
  <form id="login-form">
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" required />
    </div>
    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" id="password" required />
    </div>
    <button type="submit" class="btn btn-block">Sign In</button>
  </form>
  <div style="text-align: center; margin-top: 1rem">
    <a
      href="/register/"
      style="color: var(--primary-color); text-decoration: none"
      >Create an account</a
    >
  </div>
</div>

<script>
  document
    .getElementById("login-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const errorDiv = document.getElementById("error-msg");

      try {
        const response = await fetch("/api/accounts/login/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem("access_token", data.access);
          localStorage.setItem("refresh_token", data.refresh);
          window.location.href = "/dashboard/";
        } else {
          errorDiv.textContent = data.detail || "Invalid credentials";
          errorDiv.style.display = "block";
        }
      } catch (error) {
        errorDiv.textContent = "An error occurred";
        errorDiv.style.display = "block";
      }
    });

  // Check if already logged in
  if (localStorage.getItem("access_token")) {
    // window.location.href = '/dashboard/';
  }
</script>
{% endblock %}
